(()=>{"use strict";function t(t,e){let n=document.getElementById("tdsc-live-region");n||(n=document.createElement("div"),n.id="tdsc-live-region",n.className="tdsc-live-region",n.setAttribute("role","status"),n.setAttribute("aria-live","polite"),n.setAttribute("aria-atomic","true"),document.body.appendChild(n));const o=t.querySelector(".tdsc-collapse__toggle"),a=o?o.textContent.trim():"Panel",s=e?`${a} expanded`:`${a} collapsed`;n.textContent=s}function e(t,e){const n=t.id||t.getAttribute("data-panel-id");n&&"undefined"!=typeof tdscAjax&&(window.tdscPanelStates&&(window.tdscPanelStates[n]=e),tdscAjax.postId&&tdscAjax.nonce&&fetch(tdscAjax.ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"tdsc_save_panel_state",nonce:tdscAjax.nonce,post_id:tdscAjax.postId,panel_id:n,is_open:e?"1":"0"})}).catch((()=>{})))}function n(t,e){if("true"!==t.getAttribute("data-enable-analytics"))return;const n=t.id||t.getAttribute("data-panel-id")||"unknown",o=new CustomEvent("tdsc:panel-toggle",{detail:{panelId:n,action:e,timestamp:Date.now()},bubbles:!0});document.dispatchEvent(o),"undefined"!=typeof gtag&&gtag("event","collapse_panel_"+e,{panel_id:n})}function o(o,a,s,i=!1){try{const c=o.classList.contains("is-open"),d=s.scrollHeight,r=function(t,e){if(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return 0;const n={slow:600,normal:300,fast:150},o=n[t.getAttribute("data-animation-speed")||"normal"]||n.normal;if(e>0){const t=Math.min(Math.max(e,200),1e3);return Math.min(t,2*o)}return o}(o,d);if(c)s.style.transition=r>0?`max-height ${r}ms ease`:"none",s.style.maxHeight=d+"px",0===r?s.style.maxHeight="0px":requestAnimationFrame((()=>{s.style.maxHeight="0px"})),a.setAttribute("aria-expanded","false"),o.classList.remove("is-open"),t(o,!1),n(o,"close"),e(o,!1);else if(s.style.transition=r>0?`max-height ${r}ms ease`:"none",s.style.maxHeight=d+"px",a.setAttribute("aria-expanded","true"),o.classList.add("is-open"),t(o,!0),n(o,"open"),e(o,!0),i&&s){const t=s.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');t&&setTimeout((()=>t.focus()),r+50)}}catch(t){console.error("Error toggling collapse panel:",t)}}function a(){const t=window.location.hash.substring(1);t&&function(t){if(!t)return;const e=document.querySelector(`[id="${t}"], [data-panel-id="${t}"]`);if(!e)return;const n=e.querySelector(".tdsc-collapse__toggle"),a=e.querySelector(".tdsc-collapse__content");if(n&&a&&!e.classList.contains("is-open")){const t="true"===e.getAttribute("data-focus-on-open");o(e,n,a,t),setTimeout((()=>{const t=e.getBoundingClientRect(),n=window.pageYOffset||document.documentElement.scrollTop;window.scrollTo({top:t.top+n-100,behavior:"smooth"})}),100)}}(t)}function s(t){const e=t.querySelector(".tdsc-collapse__toggle"),n=t.querySelector(".tdsc-collapse__content");if(!e||!n)return;const a=e.id||t.getAttribute("data-panel-id");let s=t.classList.contains("is-open");window.tdscPanelStates&&a&&void 0!==window.tdscPanelStates[a]&&(s=window.tdscPanelStates[a],s&&!t.classList.contains("is-open")?(t.classList.add("is-open"),e.setAttribute("aria-expanded","true")):!s&&t.classList.contains("is-open")&&(t.classList.remove("is-open"),e.setAttribute("aria-expanded","false"))),s&&(n.style.maxHeight=n.scrollHeight+"px");const i="true"===t.getAttribute("data-focus-on-open"),c="false"!==t.getAttribute("data-enable-hash-link");if(c&&!t.id){const n=e.id||t.getAttribute("data-panel-id");n&&(t.id=n.replace("-heading",""))}e.addEventListener("click",(()=>{o(t,e,n,i),c&&t.id&&(t.classList.contains("is-open")?window.history.pushState(null,"",`#${t.id}`):window.location.hash===`#${t.id}`&&window.history.pushState(null,"",window.location.pathname+window.location.search))})),e.addEventListener("keydown",(a=>{"Enter"!==a.key&&" "!==a.key||(a.preventDefault(),o(t,e,n,i))}))}window.addEventListener("load",(function(){if(!document.body.classList.contains("block-editor-page"))try{const t=document.querySelectorAll(".tdsc-collapse");if("IntersectionObserver"in window&&t.length>5){const e=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&(s(t.target),e.unobserve(t.target))}))}),{rootMargin:"50px"});t.forEach((t=>{e.observe(t)}))}else t.forEach((t=>{s(t)}));a(),window.addEventListener("hashchange",a)}catch(t){console.error("Error initializing collapse panels:",t)}}))})();